---
title: "Figure 2 Network Synthesis"
author: "AMP"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(googlesheets4)
library(googledrive)

getwd()
```

```{r load in data}

hexs_lc_nw <- readxl::read_excel("./hexagons_State_Land_cover_Hazards.xlsx")
```

```{r summarize by state & lc}

hazards <- hexs_lc_nw %>%
  select(Hurricane:Total_hazards) %>%
  colnames() 

state_lc_nw <- hexs_lc_nw %>%
  select(STATE_NAME,dominant_LC,Hurricane:Total_hazards,count_coord_distrib_exp_obs:count_reserves_50km) %>%
  as.data.frame() %>%
  group_by(STATE_NAME,dominant_LC) %>%
  mutate(number_hex = n()) %>%
  ungroup()%>%
 group_by(STATE_NAME,dominant_LC,number_hex) %>%
 rename_with(.cols=matches(hazards), ~paste0('haz_', .x)) %>%
  dplyr::summarise(across(everything(), sum)) %>%
  ungroup() %>%
  dplyr::mutate(across(starts_with("haz"), ~.x /number_hex),
                across(starts_with("count"), ~.x /number_hex) ) %>%
    group_by(STATE_NAME, dominant_LC) %>%
   dplyr::mutate(rel_num_all_haz_per_hex= rowSums(pick(haz_Hurricane:haz_SLR), na.rm = TRUE)) %>% #this is the total relative proportion of all hazards per hexagon. for example, 100% of Alabama Hexs are vulnerable to hurricanes, while only 40% are vulnerable to flooding so the sum of this number is the rel number of hazards each hex in that state would be exposed to...
dplyr::mutate(rel_num_all_networks_per_hex= rowSums(pick(count_coord_distrib_exp_obs:count_ecolo_obs_netw_NERRpoly), na.rm = TRUE))

state_lc_haznw_sum <- state_lc_nw %>%
 group_by(STATE_NAME) %>%
  select(STATE_NAME,dominant_LC, rel_num_all_haz_per_hex,rel_num_all_networks_per_hex)%>%
    pivot_wider(names_from = dominant_LC, values_from = c(rel_num_all_haz_per_hex,rel_num_all_networks_per_hex))
```
National Wetland Condition Assessment Grouped Ecoregions
To allow assessment of condition for distinct wetland types across ecoregions with an acceptable degree of statistical certainty (i.e., a sufficient number of sampled sites by wetland type), NWCA further combined the nine aggregated ecoregions into five NWCA ecoregions:

Coastal Plains = Alabama, Arkansas, Delaware, Florida, Georgia, Kentucky, Maryland, Massachusetts, Mississippi, New Jersey, New York, North Carolina, Oklahoma, South Carolina, Rhode Island, Tennessee, Texas and Virginia
Eastern Mountains and Upper Midwest
Inland Plains
Western Mountains
Xeric

https://www.epa.gov/national-aquatic-resource-surveys/ecoregions-used-national-aquatic-resource-surveys

```{r ecoregions}
ecoregions <- state_lc_nw %>%
  select(STATE_NAME) %>%
  unique(STATE_NAME) %>%
  mutate(ecoregion = case_when(STATE_NAME %in% c(Alabama, Arkansas, Delaware, Florida, Georgia, Kentucky, Maryland, Massachusetts, Mississippi, New Jersey, New York, North Carolina, Oklahoma, South Carolina, Rhode Island, Tennessee, Texas,Virginia) ~ "coastal plain",
                              STATE_NAME %in% c(Alabama, Arkansas, Delaware, Florida, Georgia, Kentucky, Maryland, Massachusetts, Mississippi, New Jersey, New York, North Carolina, Oklahoma, South Carolina, Rhode Island, Tennessee, Texas,Virginia) ~ "coastal plain",
                               
    
  ))
```

```{r figures}

state_lc_nw  %>%
  filter(!dominant_LC %in% "water") %>%
 ggplot(aes(x=rel_num_all_haz_per_hex,
             y=rel_num_all_networks_per_hex, color=factor(dominant_LC)))+
 geom_point()+
  theme_classic() +
  labs(x = "Relative Total Number of Hazards per State", y = "Relative Number of Network Sites withink 50km per State", fill = "Dominant Land Cover Type")
```

+
  labs(x = "Burn Type", y = "Leached Nitrogen \n (mg TDN/ g N)", fill = "Land Coverage")+
   theme(legend.position="none", 
        plot.title =  element_text(size=12), axis.text.y=element_text(size=12,
                                                                     color="black"),
        axis.title.y=element_text(size=12),
        axis.text.x= element_text(size=10, color= "black",angle = 45, hjust = 1),
        axis.title.x=element_text(size=12),
        strip.text = element_blank())+
  facet_wrap(~factor(Land_Coverage_Category,level=veg_order), nrow = 1)+
  theme(strip.background = element_blank())+
  scale_fill_manual(values=color_order2)  + 
  scale_y_continuous(limits=c(0,150),breaks=seq(0,150,50))